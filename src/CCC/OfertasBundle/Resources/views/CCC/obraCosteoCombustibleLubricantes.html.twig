{% extends '::base.html.twig' %}

{% block css %}
    {# PARA EL DATATABLE #}
    <link href="{{ asset('bundles/ccc/css/jquery.dataTables.css') }}" rel="stylesheet" type="text/css" />
    <style>
        th, td { white-space: nowrap; }
        div.dataTables_wrapper {
            width: 100%;
            margin: 0 auto;
        }
    </style>
{% endblock %}

{% block contenido %}
    <section id="main-content">

        {% block titulo %}
            <section class="wrapper">

                <div class="row">
                    <div class="col-lg-12">
                        <h3 class="page-header" style="text-align: center">{#<i class="fa fa-laptop"></i>#} Costeo de la Obra <a>{{ costeo.idObra.objeto }}</a></h3>
                         <ol class="breadcrumb">
                             <li><i class="fa fa-home"></i><a href="{{ path('estatica', {'estatica':'inicio'}) }}">Inicio</a></li>
                             <li><i class="icon_archive"></i><a href="{{ path('obras') }}">Obras</a></li>
                             <li><i class="icon_pencil-edit_alt"></i><a href="{{ path('costeoObra',{'id':costeo.idObra.id}) }}">Costeo</a></li>
                             <li><i class="icon_menu-square_alt2"></i>Combustible y Lubricantes</li>
                         </ol>
                    </div>
                </div>

            </section>
        {% endblock %}

        <section class="panel">
            <header class="panel-heading tab-bg-primary ">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#home">Vehículos Directo en Obra</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#about">Vehículos Indirecto a la Obra</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#aceites">Aceites</a>
                    </li>
                </ul>
            </header>
            <div class="panel-body">
                <div class="tab-content">
                    <div id="home" class="tab-pane active">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <section class="panel">
                                            <header class="panel-heading">
                                                Trabajo con los Vehículos Directo en Obra
                                            </header>
                                            <div class="panel-body">
                                                <form class="form-horizontal " method="get">
                                                    <section class="panel">
                                                        <header class="panel-heading tab-bg-primary ">
                                                            <ul class="nav nav-tabs">
                                                                <li class="active">
                                                                    <a data-toggle="tab" href="#listado">Vehículos</a>
                                                                </li>
                                                                <li class="">
                                                                    <a data-toggle="tab" href="#adicionar">Adicionar</a>
                                                                </li>
                                                            </ul>
                                                        </header>
                                                        <div class="panel-body">
                                                            <div class="tab-content">
                                                                <div id="listado" class="tab-pane active">
                                                                    {% if costeo.vehiculosDO | length > 0 %}
                                                                        <div class="row">
                                                                            <div class="col-lg-12">

                                                                            </div>
                                                                        </div>
                                                                    {% endif %}

                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <table id="tabla" class="display">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>Vehículos Directo en Obra</th>
                                                                                    <th>Cantidad</th>
                                                                                    <th>Índice %</th>
                                                                                    <th>Km/Diario</th>
                                                                                    <th>Ltr/Diario</th>
                                                                                    <th>Ltr/Mes</th>
                                                                                    <th>Opciones</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>

                                                                                {% set kmetrajeVDO = 0 %}
                                                                                {% for vehDO in costeo.vehiculosDO %}
                                                                                    {% set kmetrajeVDO = kmetrajeVDO + vehDO.kmDiario %}
                                                                                    <tr>
                                                                                        <td>
                                                                                            {% for veiculosD in veiculosDO if veiculosD.id == vehDO.descripcion %}
                                                                                                {{ veiculosD.nombre }}
                                                                                            {% endfor %}
                                                                                        </td>
                                                                                        <td>{{ vehDO.cantidadVehiculos }}</td>
                                                                                        <td>{{ vehDO.indicePromedio }}</td>
                                                                                        <td>{{ vehDO.kmDiario }}</td>
                                                                                        <td>{{ vehDO.kmDiario / vehDO.indicePromedio }}</td>
                                                                                        <td>{{ (vehDO.kmDiario / vehDO.indicePromedio) * 24 * vehDO.cantidadVehiculos }}</td>

                                                                                        <td>
                                                                                            <a class="btn btn-primary  btn-sm" title="Editar Vehículo" href="{#{{ path('obrasCliente',{ 'id' : cliente.id}) }}#}">
                                                                                                <i class="icon_pencil-edit"></i>
                                                                                            </a>
                                                                                            {% if is_granted('ROLE_SUPER_ADMIN') %}
                                                                                                <a class="btn btn-danger btn-sm" title="Eliminar Vehículo Directo en Obra" href="{{ path('eliminarVehiculoDOCosteoObra',{ 'id' : vehDO.id}) }}">
                                                                                                    <i class="icon_trash"></i>
                                                                                                </a>
                                                                                            {% endif %}
                                                                                        </td>
                                                                                    </tr>
                                                                                {% endfor %}
                                                                                {% set kmetrajeVDO = kmetrajeVDO * 31 %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="adicionar" class="tab-pane">
                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <section class="panel">
                                                                                <header class="panel-heading">
                                                                                    Formulario para el trabajo con los Vehículos Directos en Obra
                                                                                </header>
                                                                                <div class="panel-body">
                                                                                    <form {#method="post" action="{{ path('insertarSocioDO', {'id' : costeo.id}) }}"#} class="form-horizontal"  >
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Vehículo</label>
                                                                                            <div class="col-sm-6">
                                                                                                <select id="descipcion" name="descipcion" class="form-control round-input" required="required">
                                                                                                    <option></option>
                                                                                                    {% for veiculDO in veiculosDO %}
                                                                                                        <option value="{{ veiculDO.id }}">{{ veiculDO.nombre }}</option>
                                                                                                    {% endfor%}
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Cantidad de Vehículos</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="cantidad" name="cantidad" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Índice Promedio</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="indicePromedio" name="indicePromedio" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Km/Diario</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="kmDiario" name="kmDiario" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <div class="col-sm-10">
                                                                                                <button formmethod="post" formaction="{{ path('insertarVehiculoDOCosteoObra', {'id' : costeo.id}) }}" type="submit" value="Enviar Datos" class="btn btn-info">Enviar Datos</button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                </div>
                                                                            </section>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </section>
                                                </form>
                                            </div>
                                        </section>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div id="about" class="tab-pane">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <section class="panel">
                                            <header class="panel-heading">
                                                Trabajo con los Vehícolos Indirectos a la Obra
                                            </header>
                                            <div class="panel-body">
                                                <form class="form-horizontal " method="get">
                                                    <section class="panel">
                                                        <header class="panel-heading tab-bg-primary ">
                                                            <ul class="nav nav-tabs">
                                                                <li class="active">
                                                                    <a data-toggle="tab" href="#listadoCon">Vehículos</a>
                                                                </li>
                                                                <li class="">
                                                                    <a data-toggle="tab" href="#adicionarCon">Adicionar</a>
                                                                </li>
                                                            </ul>
                                                        </header>
                                                        <div class="panel-body">
                                                            <div class="tab-content">
                                                                <div id="listadoCon" class="tab-pane active">
                                                                    {% if costeo.vehiculosIO | length > 0 %}
                                                                        <div class="row">
                                                                            <div class="col-lg-12">

                                                                            </div>
                                                                        </div>
                                                                    {% endif %}

                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <table id="tablaCon" class="display">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>Vehículos Indirectos a la Obra</th>
                                                                                    <th>Viajes a Obra Mensual</th>
                                                                                    <th>Índice %</th>
                                                                                    <th>Distancia Obra (ida y vuelta)</th>
                                                                                    <th>Ltr/Diario</th>
                                                                                    <th>Ltr/Mes</th>
                                                                                    <th>Opciones</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>

                                                                                {% set kmetrajeVIO = 0 %}
                                                                                {% set kmetrajeAceite = 0 %}
                                                                                {% for vehIO in costeo.vehiculosIO %}
                                                                                    {% set kmetrajeVIO = kmetrajeVIO + (vehIO.cantidadVehiculos * vehIO.kmDiario ) %}
                                                                                    <tr>
                                                                                        <td>
                                                                                            {% for veiculIO in veiculosIO if veiculIO.id == vehIO.descipcion %}
                                                                                                {{ veiculIO.nombre }}
                                                                                            {% endfor %}
                                                                                        </td>
                                                                                        <td>{{ vehIO.cantidadVehiculos }}</td>
                                                                                        <td>{{ vehIO.indicePromedio }}</td>
                                                                                        <td>{{ vehIO.kmDiario }}</td>
                                                                                        <td>{{ vehIO.kmDiario / vehIO.indicePromedio }}</td>
                                                                                        <td>{{ (vehIO.kmDiario / vehIO.indicePromedio) * vehIO.cantidadVehiculos }}</td>

                                                                                        <td>
                                                                                            <a class="btn btn-primary  btn-sm" title="Editar Vehículo" href="{#{{ path('obrasCliente',{ 'id' : cliente.id}) }}#}">
                                                                                                <i class="icon_pencil-edit"></i>
                                                                                            </a>
                                                                                            {% if is_granted('ROLE_SUPER_ADMIN') %}
                                                                                                <a class="btn btn-danger btn-sm" title="Eliminar Vehículo Inirecto a la Obra" href="{{ path('eliminarVehiculoIOCosteoObra',{ 'id' : vehIO.id}) }}">
                                                                                                    <i class="icon_trash"></i>
                                                                                                </a>
                                                                                            {% endif %}
                                                                                        </td>
                                                                                    </tr>
                                                                                {% endfor %}
                                                                                {% set kmetrajeAceite = kmetrajeVIO + kmetrajeVDO %}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="adicionarCon" class="tab-pane">
                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <section class="panel">
                                                                                <header class="panel-heading">
                                                                                    Formulario para el trabajo con los Vehículos Indirectos a la Obra
                                                                                </header>
                                                                                <div class="panel-body">
                                                                                    <form {#method="post" action="{{ path('insertarSocioDO', {'id' : costeo.id}) }}"#} class="form-horizontal"  >
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Vehículo</label>
                                                                                            <div class="col-sm-6">
                                                                                                <select id="descipcion" name="descipcion" class="form-control round-input" required="required">
                                                                                                    <option></option>
                                                                                                    {% for veiculIO in veiculosIO %}
                                                                                                        <option value="{{ veiculIO.id }}">{{ veiculIO.nombre }}</option>
                                                                                                    {% endfor%}
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Viajes a Obra Mensual</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="cantidad" name="cantidad" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Índice Promedio</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="indicePromedio" name="indicePromedio" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Distancia Obra (ida y vuelta)</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="kmDiario" name="kmDiario" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <div class="col-sm-10">
                                                                                                <button formmethod="post" formaction="{{ path('insertarVehiculoIOCosteoObra', {'id' : costeo.id}) }}" type="submit" value="Enviar Datos" class="btn btn-info">Enviar Datos</button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                </div>
                                                                            </section>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </section>
                                                </form>
                                            </div>
                                        </section>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div id="aceites" class="tab-pane">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <section class="panel">
                                            <header class="panel-heading">
                                                Trabajo con el Aceite para Equipos
                                            </header>
                                            <div class="panel-body">
                                                <form class="form-horizontal " method="get">
                                                    <section class="panel">
                                                        <header class="panel-heading tab-bg-primary ">
                                                            <ul class="nav nav-tabs">
                                                                <li class="active">
                                                                    <a data-toggle="tab" href="#listadoAce">Cantidad</a>
                                                                </li>
                                                                <li class="">
                                                                    <a data-toggle="tab" href="#adicionarAce">Adicionar</a>
                                                                </li>
                                                            </ul>
                                                        </header>
                                                        <div class="panel-body">
                                                            <div class="tab-content">
                                                                <div id="listadoAce" class="tab-pane active">
                                                                    {% if costeo.aceiteVehiculos | length > 0 %}
                                                                        <div class="row">
                                                                            <div class="col-lg-12">

                                                                            </div>
                                                                        </div>
                                                                    {% endif %}

                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <table id="tablaAce" class="display">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>Vehículos</th>
                                                                                    <th>Índice(Ltr Ace/Km)</th>
                                                                                    <th>Km/Mensuales</th>
                                                                                    <th>Ltr/Mes</th>
                                                                                    <th>Opciones</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>

                                                                                {% for aceiteVeh in costeo.aceiteVehiculos %}
                                                                                    <tr>
                                                                                        <td>
                                                                                            {% for aceiteVeicul in aceiteVeiculos if aceiteVeicul.id == aceiteVeh.descripcion %}
                                                                                                {{ aceiteVeicul.nombre }}
                                                                                            {% endfor %}
                                                                                        </td>
                                                                                        <td>{{ aceiteVeh.indide }}</td>
                                                                                        <td>
                                                                                            {{ kmetrajeAceite }}
                                                                                        </td>
                                                                                        <td>
                                                                                            {{ kmetrajeAceite / aceiteVeh.indide }}
                                                                                        </td>
                                                                                        <td>
                                                                                            <a class="btn btn-primary  btn-sm" title="Editar" href="{#{{ path('obrasCliente',{ 'id' : cliente.id}) }}#}">
                                                                                                <i class="icon_pencil-edit"></i>
                                                                                            </a>
                                                                                            {% if is_granted('ROLE_SUPER_ADMIN') %}
                                                                                                <a class="btn btn-danger btn-sm" title="Eliminar Elemento" href="{{ path('eliminarAceiteCosteoObra',{ 'id' : aceiteVeh.id}) }}">
                                                                                                    <i class="icon_trash"></i>
                                                                                                </a>
                                                                                            {% endif %}
                                                                                        </td>
                                                                                    </tr>
                                                                                {% endfor %}

                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="adicionarAce" class="tab-pane">
                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <section class="panel">
                                                                                <header class="panel-heading">
                                                                                    Formulario para el trabajo con los Vehículos que utilizan aceite
                                                                                </header>
                                                                                <div class="panel-body">
                                                                                    <form {#method="post" action="{{ path('insertarSocioDO', {'id' : costeo.id}) }}"#} class="form-horizontal"  >
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Vehículo</label>
                                                                                            <div class="col-sm-6">
                                                                                                <select id="descipcion" name="descipcion" class="form-control round-input" required="required">
                                                                                                    <option></option>
                                                                                                    {% for aceiteVeic in aceiteVeiculos %}
                                                                                                        <option value="{{ aceiteVeic.id }}">{{ aceiteVeic.nombre }}</option>
                                                                                                    {% endfor%}
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label class="col-sm-4 control-label">Índice (Ltr/Km)</label>
                                                                                            <div class="col-sm-6">
                                                                                                <input id="indicePromedio" name="indicePromedio" type="text" class="form-control round-input" required="required">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <div class="col-sm-10">
                                                                                                <button formmethod="post" formaction="{{ path('insertarAceiteCosteoObra', {'id' : costeo.id}) }}" type="submit" value="Enviar Datos" class="btn btn-info">Enviar Datos</button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>
                                                                                </div>
                                                                            </section>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </section>
                                                </form>
                                            </div>
                                        </section>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>
{% endblock %}
{% block js %}
    <script src="{{asset('bundles/ccc/js/jquery.hotkeys.js')}}"></script>
    <script src="{{asset('bundles/ccc/js/bootstrap-wysiwyg.js')}}"></script>
    <script src="{{asset('bundles/ccc/js/bootstrap-wysiwyg-custom.js')}}"></script>
    <script src="{{asset('bundles/ccc/assets/ckeditor/ckeditor.js')}}"></script>


    {# PARA EL DATATABLE #}
    <script src="{{asset('bundles/ccc/js/jquery.dataTables.js')}}" type="text/javascript" ></script>
    <script>
        $(document).ready(function() {
            $('#tabla').dataTable( {
                 "scrollY": 250,
                 "scrollX": true
            } );
        } );
        $(document).ready(function() {
            $('#tablaCon').dataTable( {
                /*"scrollY": 250,
                "scrollX": true*/
            } );
        } );
        $(document).ready(function() {
            $('#tablaPT').dataTable( {
               /* "scrollY": 250,
                "scrollX": true*/
            } );
        } );
        $(document).ready(function() {
            $('#tablaAce').dataTable( {
                /* "scrollY": 250,
                 "scrollX": true*/
            } );
        } );
    </script>

{% endblock %}


